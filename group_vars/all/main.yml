ec2_ssh_key_name:  Andy SSH                      # Name for uploaded SSH key
ec2_ssh_key:       ~/.ssh/id_rsa.pub             # Local path to SSH key
ec2_instance_type: t2.nano                       # Size of EC2 instance to provision
ec2_region:        us-east-1                     # Region to deploy AWS environment
ec2_instance_ami:  ami-039eb499c36219cad         # ID of the AMI used for EC2 instances
ansible_playbook:  playbook_ec2.yml              # Ansible playbook for provisioning EC2 instances
import_archive:    no
secrets_length:    32                            # Number of randomly generated chars in each secret
generate_dh_param: yes

# Host bind-mount paths
postgres_data:     /opt/postgres/data
mailman_core:      /opt/mailman/core

# Other variables shared with Ansible
mailman_admin:     mailman
mailman_rest_user: restadmin
postgres_user:     postgres
postgres_db:       mailmandb

# Terraform auto-generates randomized secrets for each item in the secrets: map
secrets:
  django_secret_key:
    description:   Django secret key.
  mailman_rest_password:
    description:   Mailman REST API password
  hyperkitty_api_key:
    description:   Hyperkitty API key.
  postgres_password:
    description:   PostgresQL password.

# Terraform auto-generates ECS tasks and security groups for each item in the
# services: map. A service with 'public' == true is reachable from the Internet;
# otherwise, the ports will only be reachable by hosts in the private subnet.
services:
  postgres:
    description:   PostgreSQL (private)
    ecs_service:   yes
    memory:        256
    cpu:           0
    on_role:       mail
    ports:
      - 5432:5432
    public:        no
    mounts:
      - postgres_data:/var/lib/postgresql/data
  mailman-core:
    description:   Mailman Core REST API (private)
    ecs_service:   yes
    memory:        256
    cpu:           0
    on_role:       mail
    ports:
      - 8001:8001
    public:        no
    mounts:
      - mailman_core:/opt/mailman

# Terraform auto-generates security groups for each item in the security_groups: map.
# 'public' groups are globally routable. 'private' groups route just within VPC
# private subnets.
security_groups:
  public:
    smtp:
      ports:       [25]
      description: SMTP
    https:
      ports:       [80, 443]
      description: HTTP/S
  private:
    mailman-web:
      ports:       [8000]
      description: HyperKitty and Postorius REST API
